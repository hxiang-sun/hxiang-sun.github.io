document.addEventListener("DOMContentLoaded",function(){const t=document.querySelectorAll(".snippet-ref"),s=document.querySelectorAll(".snippet"),e=document.querySelector(".snippets-container");let n=null;function o(){if(window.innerWidth<800||!e)return;const n=e.getBoundingClientRect(),s=n.top;t.forEach((e,t)=>{const n=document.getElementById("snippet-"+t);if(n){const o=e.getBoundingClientRect(),t=o.top,i=t-s;n.style.position="absolute",n.style.top=i+"px";const a=t>0&&t<window.innerHeight;a?n.classList.add("visible"):n.classList.remove("visible")}})}if(t.forEach((t,o)=>{t.addEventListener("click",function(t){t.preventDefault();const i=document.getElementById("snippet-"+o);if(i&&window.innerWidth>=800){s.forEach(e=>e.classList.remove("active")),i.classList.add("active","visible"),n=i;const t=parseInt(i.style.top)||0,o=e.offsetHeight,a=i.offsetHeight,r=t-o/2+a/2;e.scrollTo({top:r,behavior:"smooth"})}})}),window.innerWidth>=800){const o={rootMargin:"-30% 0px -60% 0px",threshold:[0,1]},i=new IntersectionObserver(t=>{t.forEach(t=>{if(t.isIntersecting){const i=t.target.getAttribute("data-snippet"),o=document.getElementById("snippet-"+i);if(o&&!n){s.forEach(e=>e.classList.remove("active")),o.classList.add("active");const t=parseInt(o.style.top)||0,n=e.offsetHeight,i=e.scrollTop,a=o.offsetHeight;if(t<i||t+a>i+n){const s=t-n/2+a/2;e.scrollTo({top:s,behavior:"smooth"})}}}})},o);t.forEach(e=>i.observe(e))}document.addEventListener("click",function(e){!e.target.closest(".snippet-ref")&&!e.target.closest(".snippet")&&(n=null)}),window.innerWidth>=800&&(o(),updateVisibleSnippets(),e.addEventListener("scroll",updateVisibleSnippets),window.addEventListener("resize",()=>{o(),updateVisibleSnippets()}))})